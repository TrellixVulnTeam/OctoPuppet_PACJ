{{ _('Machine State') }}: <strong data-bind="text: stateString"></strong><br>
{{ _('File') }}: <strong data-bind="text: filename"></strong>&nbsp;<strong data-bind="visible: sd">(SD)</strong><br>
{{ _('Timelapse') }}: <strong data-bind="text: timelapseString"></strong><br>
<!-- ko foreach: filament -->
<span data-bind="text: 'Filament (' + name() + '): '"></span><strong data-bind="text: formatFilament(data())"></strong><br>
<!-- /ko -->
{{ _('Approx. Total Print Time') }}: <strong data-bind="text: estimatedPrintTimeString"></strong><br>
{{ _('Print Time') }}: <strong data-bind="text: printTimeString"></strong><br>
{{ _('Print Time Left') }}: <strong data-bind="text: printTimeLeftString"></strong><br>
{{ _('Printed') }}: <strong data-bind="text: byteString"></strong><br>

<div class="progress">
    <div class="bar" id="job_progressBar" data-bind="style: { width: progressString() + '%' }"></div>
</div>

<div class="row-fluid print-control" style="display: none;" data-bind="visible: loginState.isUser">
    <button class="btn btn-primary span4" data-bind="click: print, enable: enablePrint, css: {'btn-danger': isPaused()}, attr: {title: titlePrintButton}" id="job_print"><i class="icon-white" data-bind="css: {'icon-print': !isPaused(), 'icon-undo': isPaused()}"></i> <span data-bind="text: (isPaused() ? '{{ _('Restart') }}' : '{{ _('Print') }}')">{{ _('Print') }}</span></button>
    <button class="btn span4" id="job_pause" data-bind="click: pause, enable: enablePause, css: {active: isPaused()}, attr: {title: titlePauseButton}"><i data-bind="css: {'icon-pause': !isPaused(), 'icon-play': isPaused()}"></i> <span data-bind="visible: !isPaused()">{{ _('Pause') }}</span><span data-bind="visible: isPaused()">{{ _('Resume') }}</span></button>
    <button class="btn span4" id="job_cancel" data-bind="click: cancel, enable: enableCancel" title="{{ _('Cancels the print job') }}"><i class="icon-stop"></i> {{ _('Cancel') }}</button>
</div>

<script type="text/javascript">

var last_key_time = new Date();
var last_id_length = 0;

function forcecard() {
/*
	var key_time = new Date();
	var id_length = document.getElementById('studentId').value.length;
	
	if ( id_length == 1) {
		last_key_time = key_time;
	}
	
	if ((key_time - last_key_time) > 100){
		document.getElementById('studentId').value="";
		last_id_length = 0;
		alert("please swipe your MavID card. Contact a FabLab employee for assistance.");
		return false;
	}
	
	if (id_length != last_id_length){
		last_key_time = key_time;
		last_id_length = id_length;
	}*/

	//to make sure the entry happened from swipe card we check the time for populating text
    if (document.getElementById('studentId').value.length == 1) {
        startdatetime = new Date();
    }
	// time at tenth character
    else if (document.getElementById('studentId').value.length == 8) {
        enddatetime = new Date();
        var difference_ms = enddatetime - startdatetime;
    }
    if (difference_ms > 100) {
        document.getElementById('studentId').value="";
		alert("Please swipe your MavID. Contact a FabLab employee for assistance.");
        return false;
    }
	
}

function check_id_valid(){
	console.log("running template based ID check");
	var modal_ok_button = document.getElementById("studentIdVerification");
	if ( document.getElementById('studentId').value.length == 10) {
		modal_ok_button.removeAttribute("disabled"); 
	}
	else {
		modal_ok_button.setAttribute("disabled", "disabled");
	}
}
	
</script>

<div hidden="true" class="modal fade" id="studentIdModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Swipe Mav Express Card</h4>
      </div>
      <div class="modal-body">
        <p>To ensure that the UTA FabLab is an ethical learning environment, only upload files that meet the guidelines set by the UTA Fablab and the UTA Libraries. The UTA Libraries reserve the right to refuse/destroy any fabrication requests which do not meet our guidelines. Please visit http://fablab.uta.edu/policy for more information.</p>
		<p>By swiping your Mav Express Card and pressing the "Agree" button, you agree to the guidelines set by the UTA FabLab.</p>
		<p><h4>Important: Make sure that the filament is loaded and heaters are online before pressing the "Agree" button.</h4></p>
		<input type="text" id="studentId" onkeydown="forcecard()" onkeyup="check_id_valid()" onselectstart="return false" onpaste="return false;" onCopy="return false" onCut="return false" onDrag="return false" onDrop="return false" autocomplete=off />
		<p>Select Filament:
			<select id="sel_filament">
				<option id="sel_filament_default_option" value="" disabled selected>Loading...</option>
			</select>
		</p>
		<p>Purpose of visit:
			<select id="sel_purpose">
				<option id="sel_purpose_default_option" value="" disabled selected>Loading...</option>
			</select>
		</p>
	  </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Disagree</button>
        <button id="studentIdVerification" type="button" class="btn btn-success" data-dismiss="modal" >Agree</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
